<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™“æ—åœ¨çº¿å½±é™¢</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* === 1. å…¨å±€æ ·å¼å˜é‡ === */
        :root {
            --sidebar-width: 250px;
            --header-height: 64px;
        }

        /* æš—é»‘æ¨¡å¼ (Dark) */
        body.theme-dark {
            --bg-body: #121212;
            --bg-sidebar: #1e1e1e;
            --bg-header: #1e1e1e;
            --bg-card: #2c2c2c;
            --text-main: #ffffff;
            --text-sub: #aaaaaa;
            --accent: #3ea6ff;
            --hover: #383838;
            --border: rgba(255,255,255,0.1);
        }

        /* äº®è‰²æ¨¡å¼ (Light) */
        body.theme-light {
            --bg-body: #f5f7fa;
            --bg-sidebar: #ffffff;
            --bg-header: #ffffff;
            --bg-card: #ffffff;
            --text-main: #333333;
            --text-sub: #666666;
            --accent: #0984e3;
            --hover: #f0f0f0;
            --border: #e0e0e0;
        }

        /* ç½‘é£çº¢æ¨¡å¼ (Netflix) */
        body.theme-red {
            --bg-body: #000000;
            --bg-sidebar: #141414;
            --bg-header: #000000; 
            --bg-card: #1f1f1f;
            --text-main: #e5e5e5;
            --text-sub: #999999;
            --accent: #e50914; 
            --hover: #333333;
            --border: #333;
        }

        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg-body); 
            color: var(--text-main); 
            height: 100vh; 
            overflow: hidden; 
            transition: background 0.3s ease, color 0.3s ease; 
        }
        
        .app-container { display: flex; height: 100%; flex-direction: column; }
        .main-wrapper { display: flex; flex: 1; overflow: hidden; position: relative; }

        /* === 2. é¡¶éƒ¨å¯¼èˆªæ  === */
        .header {
            height: var(--header-height); background: var(--bg-header); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 24px;
            position: relative; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .brand { font-size: 22px; font-weight: 800; display: flex; align-items: center; gap: 10px; cursor: pointer; user-select: none; }
        .brand i { color: var(--accent); }
        
        .search-wrap { flex: 1; max-width: 500px; margin: 0 40px; position: relative; }
        .search-wrap input {
            width: 100%; background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main);
            padding: 10px 40px 10px 15px; border-radius: 50px; outline: none; transition: 0.3s;
        }
        .search-wrap input:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(62,166,255,0.2); }
        .search-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: var(--text-sub); cursor: pointer; }

        /* ä¿®å¤ç‚¹å‡»é—®é¢˜çš„æŒ‰é’®æ ·å¼ */
        .header-actions { display: flex; align-items: center; gap: 15px; z-index: 1001; }
        .action-btn {
            width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; background: var(--bg-body); color: var(--text-main); border: 1px solid var(--border); 
            transition: all 0.2s; position: relative; overflow: hidden;
        }
        .action-btn:hover { background: var(--hover); color: var(--accent); border-color: var(--accent); transform: scale(1.05); }
        .menu-btn { display: none; font-size: 20px; cursor: pointer; padding: 10px; }

        /* === 3. å·¦ä¾§å¯¼èˆªæ  === */
        .sidebar {
            width: var(--sidebar-width); background: var(--bg-sidebar); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; flex-shrink: 0; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .sidebar-scroll { flex: 1; overflow-y: auto; padding: 10px; }
        .sidebar-scroll::-webkit-scrollbar { width: 4px; }
        .sidebar-scroll::-webkit-scrollbar-thumb { background: #555; border-radius: 2px; }

        .group-title { font-size: 12px; color: var(--text-sub); padding: 15px 12px 8px; font-weight: bold; letter-spacing: 0.5px; text-transform: uppercase; }
        
        .nav-item {
            display: flex; align-items: center; gap: 12px; padding: 12px 16px; margin-bottom: 4px;
            border-radius: 8px; cursor: pointer; color: var(--text-sub); font-size: 14px; transition: 0.2s;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .nav-item:hover { background: var(--hover); color: var(--text-main); }
        .nav-item.active { background: var(--accent); color: #fff; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .nav-item i { width: 20px; text-align: center; }

        /* === 4. å†…å®¹åŒºåŸŸ === */
        .content { flex: 1; overflow-y: auto; padding: 24px; position: relative; }
        
        .tags-bar { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        .tag {
            padding: 6px 18px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 100px;
            font-size: 13px; cursor: pointer; transition: 0.2s; color: var(--text-main);
        }
        .tag:hover { border-color: var(--accent); }
        .tag.active { background: var(--text-main); color: var(--bg-body); border-color: var(--text-main); font-weight: bold; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 24px; row-gap: 32px; }
        .card { cursor: pointer; }
        .poster-box {
            width: 100%; aspect-ratio: 2/3; border-radius: 10px; overflow: hidden; position: relative;
            background: var(--bg-card); box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: transform 0.3s;
        }
        .card:hover .poster-box { transform: translateY(-6px); box-shadow: 0 10px 20px rgba(0,0,0,0.25); }
        .poster-box img { width: 100%; height: 100%; object-fit: cover; }
        .badge { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.75); color: #f1c40f; font-size: 11px; padding: 3px 6px; border-radius: 4px; backdrop-filter: blur(2px); }
        .meta { margin-top: 10px; }
        .title { font-size: 15px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .sub { font-size: 12px; color: var(--text-sub); margin-top: 4px; }

        /* === 5. æ’­æ”¾å™¨ === */
        .player-layer { display: flex; flex-direction: column; max-width: 1100px; margin: 0 auto; animation: fadeUp 0.4s ease; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .video-wrapper { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        video { width: 100%; height: 100%; outline: none; }
        
        .info-panel { padding: 20px 0; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
        .play-head { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
        .btn-back { padding: 8px 16px; background: var(--bg-card); border-radius: 6px; cursor: pointer; color: var(--text-sub); font-size: 14px; }
        .btn-back:hover { color: var(--text-main); background: var(--hover); }
        
        .ep-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; max-height: 200px; overflow-y: auto; margin-top: 15px; padding: 5px; }
        .ep-item { 
            text-align: center; padding: 8px; background: var(--bg-card); border-radius: 6px; font-size: 13px; cursor: pointer; color: var(--text-sub); transition: 0.2s; 
            border: 1px solid transparent;
        }
        .ep-item:hover { border-color: var(--accent); color: var(--text-main); }
        .ep-item.active { background: var(--accent); color: #fff; border-color: var(--accent); }

        /* === ç§»åŠ¨ç«¯é€‚é… === */
        @media (max-width: 768px) {
            .menu-btn { display: block; }
            .sidebar { position: fixed; top: var(--header-height); bottom: 0; left: 0; z-index: 999; transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
            .search-wrap { display: none; }
            .grid { grid-template-columns: repeat(3, 1fr); gap: 10px; }
            .content { padding: 15px; }
            .video-wrapper { border-radius: 0; margin: 0 -15px; width: auto; }
        }
    </style>
</head>
<body>

<div id="app" class="app-container">
    
    <header class="header">
        <div style="display: flex; align-items: center; gap: 10px;">
            <i class="fa-solid fa-bars menu-btn" @click="toggleSidebar"></i>
            <div class="brand" @click="goHome">
                <i class="fa-solid fa-cloud-bolt"></i> 
                <span>æ™“æ—å½±é™¢</span>
            </div>
        </div>

        <div class="search-wrap">
            <input v-model="keyword" @keyup.enter="doSearch" placeholder="è¾“å…¥ç‰‡åæœç´¢...">
            <i class="fa-solid fa-magnifying-glass search-icon" @click="doSearch"></i>
        </div>

        <div class="header-actions">
            <div class="action-btn" @click="switchTheme" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fa-solid fa-palette"></i>
            </div>
            <div class="action-btn">
                <i class="fa-regular fa-user"></i>
            </div>
        </div>
    </header>

    <div class="main-wrapper">
        
        <aside class="sidebar" :class="{ open: isSidebarOpen }">
            <div class="sidebar-scroll">
                
                <div class="group-title">å½“å‰çº¿è·¯</div>
                <div class="nav-item active">
                    <i class="fa-solid fa-tower-broadcast"></i>
                    <span>{{ currentSourceName }}</span>
                </div>

                <div class="group-title">ç»¼åˆèµ„æº</div>
                <div v-for="s in generalSources" :key="s.key" 
                     class="nav-item" :class="{active: currentSourceKey === s.key}"
                     @click="changeSource(s)">
                    <i :class="s.icon"></i>
                    <span>{{ s.name }}</span>
                </div>

                <template v-if="showSpecial">
                    <div class="group-title" style="margin-top:20px; color:#e74c3c;">ç‰¹æ®Š/ç¦åˆ©</div>
                    <div v-for="s in specialSources" :key="s.key" 
                         class="nav-item" :class="{active: currentSourceKey === s.key}"
                         @click="changeSource(s)">
                        <i :class="s.icon"></i>
                        <span>{{ s.name }}</span>
                    </div>
                </template>

            </div>
        </aside>

        <div v-if="isSidebarOpen" @click="toggleSidebar" 
             style="position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:900;"></div>

        <main class="content">
            <div v-if="!playerMode">
                <div class="tags-bar">
                    <div class="tag" :class="{active: currentCat==='latest'}" @click="changeCat('latest')">æœ€æ–°æ›´æ–°</div>
                    <div class="tag" :class="{active: currentCat==='movie'}" @click="changeCat('movie')">ç”µå½±</div>
                    <div class="tag" :class="{active: currentCat==='tv'}" @click="changeCat('tv')">ç”µè§†å‰§</div>
                    <div class="tag" :class="{active: currentCat==='anime'}" @click="changeCat('anime')">åŠ¨æ¼«</div>
                    <div class="tag" :class="{active: currentCat==='variety'}" @click="changeCat('variety')">ç»¼è‰º</div>
                </div>

                <div v-if="loading" style="text-align:center; padding:50px; color:var(--accent);">
                    <i class="fa-solid fa-circle-notch fa-spin fa-2x"></i>
                </div>

                <div class="grid">
                    <div class="card" v-for="item in list" :key="item.vod_id" @click="openPlayer(item)">
                        <div class="poster-box">
                            <img :src="item.vod_pic" @error="imgError" loading="lazy">
                            <div class="badge">{{ item.vod_remarks || item.vod_year }}</div>
                        </div>
                        <div class="meta">
                            <div class="title">{{ item.vod_name }}</div>
                            <div class="sub">{{ item.type_name }} Â· {{ item.vod_time?.split(' ')[0] }}</div>
                        </div>
                    </div>
                </div>

                <div v-if="!loading && list.length === 0" style="text-align:center; margin-top:80px; color:var(--text-sub);">
                    <i class="fa-solid fa-box-open" style="font-size:40px; margin-bottom:15px;"></i>
                    <p>æš‚æ— æ•°æ®</p>
                </div>
            </div>

            <div v-else class="player-layer">
                <div class="play-head">
                    <div class="btn-back" @click="closePlayer">
                        <i class="fa-solid fa-arrow-left"></i> è¿”å›åˆ—è¡¨
                    </div>
                </div>

                <div class="video-wrapper">
                    <video id="player" controls autoplay playsinline></video>
                </div>

                <div class="info-panel">
                    <h2 style="margin:0 0 10px 0;">{{ currentVod.vod_name }}</h2>
                    <div style="font-size:13px; color:var(--text-sub);">
                        <span style="color:var(--accent)">{{ currentSourceName }}</span> 
                        <span style="margin:0 10px;">/</span> 
                        {{ currentEpName }}
                    </div>

                    <div class="ep-grid">
                        <div v-for="(url, name) in episodes" :key="name" 
                             class="ep-item" :class="{active: currentPlayUrl === url}"
                             @click="switchEp(name, url)">
                            {{ name }}
                        </div>
                    </div>
                </div>
                
                <h3 style="margin-top:20px;">çŒœä½ å–œæ¬¢</h3>
                <div class="grid">
                    <div class="card" v-for="item in recommendList" :key="item.vod_id" @click="openPlayer(item)">
                        <div class="poster-box">
                            <img :src="item.vod_pic" @error="imgError" loading="lazy">
                            <div class="badge">{{ item.vod_remarks }}</div>
                        </div>
                        <div class="meta">
                            <div class="title">{{ item.vod_name }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue;

    createApp({
        setup() {
            // ğŸ›‘ å¿…é¡»åœ¨è¿™é‡Œå¡«ä½ çš„åœ°å€ ğŸ›‘
            const API_PROXY = 'https://cf-dianying.xiaolin4914.workers.dev/'; 

            // ==========================================
            // ğŸ”’ã€éšç§å¼€å…³ã€‘åœ¨è¿™é‡Œæ§åˆ¶æ˜¯å¦æ˜¾ç¤ºç‰¹æ®Šç¦åˆ©èµ„æº
            // true = æ˜¾ç¤º, false = éšè—
            // ==========================================
            const showSpecial = ref(true); 


            // çŠ¶æ€å˜é‡
            const isSidebarOpen = ref(false);
            const themeList = ['theme-dark', 'theme-light', 'theme-red'];
            const currentTheme = ref('theme-dark');
            
            const playerMode = ref(false);
            const loading = ref(false);
            const list = ref([]);
            const recommendList = ref([]);
            const keyword = ref('');
            const currentCat = ref('latest');

            // èµ„æºåˆ—è¡¨ (ç»¼åˆ)
            const generalSources = ref([
                { key: 'guangsu', name: 'å…‰é€Ÿèµ„æº', icon: 'fa-solid fa-bolt' },
                { key: 'liangzi', name: 'é‡å­èµ„æº', icon: 'fa-solid fa-atom' },
                { key: 'hongniu', name: 'çº¢ç‰›èµ„æº', icon: 'fa-solid fa-bullhorn' },
                { key: 'ikun', name: 'iKunèµ„æº', icon: 'fa-solid fa-basketball' },
                { key: 'tianya', name: 'å¤©æ¶¯å½±è§†', icon: 'fa-solid fa-mountain-sun' },
                { key: 'kuaiche', name: 'å¿«è½¦èµ„æº', icon: 'fa-solid fa-truck-fast' },
                { key: 'wujin', name: 'æ— å°½èµ„æº', icon: 'fa-solid fa-infinity' },
                { key: 'zuidazy', name: 'æœ€å¤§èµ„æº', icon: 'fa-solid fa-maximize' },
                { key: 'yinghua', name: 'æ¨±èŠ±èµ„æº', icon: 'fa-solid fa-fan' },
                { key: 'douban', name: 'è±†ç“£èµ„æº', icon: 'fa-brands fa-douban' },
                { key: 'subo', name: 'é€Ÿæ’­èµ„æº', icon: 'fa-solid fa-forward' },
                { key: 'uku', name: 'Ué…·èµ„æº', icon: 'fa-solid fa-u' },
                { key: 'shanhai', name: 'å±±æµ·èµ„æº', icon: 'fa-solid fa-water' },
                { key: 'xinlang', name: 'æ–°æµªèµ„æº', icon: 'fa-brands fa-weibo' },
                { key: 'wangwang', name: 'æ—ºæ—ºèµ„æº', icon: 'fa-solid fa-dog' },
                { key: 'baofeng', name: 'æš´é£èµ„æº', icon: 'fa-solid fa-wind' },
                { key: 'jisu', name: 'æé€Ÿèµ„æº', icon: 'fa-solid fa-gauge-high' },
                { key: 'maoyan', name: 'çŒ«çœ¼èµ„æº', icon: 'fa-solid fa-cat' },
                { key: 'suoni', name: 'ç´¢å°¼èµ„æº', icon: 'fa-solid fa-gamepad' },
                { key: 'maotai', name: 'èŒ…å°èµ„æº', icon: 'fa-solid fa-wine-bottle' },
                { key: 'huya', name: 'è™ç‰™èµ„æº', icon: 'fa-solid fa-paw' },
                { key: 'jinying', name: 'é‡‘é¹°èµ„æº', icon: 'fa-solid fa-feather' },
                { key: 'shandian', name: 'é—ªç”µèµ„æº', icon: 'fa-solid fa-bolt-lightning' },
                { key: 'feifan', name: 'éå‡¡èµ„æº', icon: 'fa-solid fa-plane' },
                { key: 'piaoling', name: 'é£˜é›¶èµ„æº', icon: 'fa-solid fa-snowflake' },
                { key: 'modu', name: 'é­”éƒ½èµ„æº', icon: 'fa-solid fa-city' },
                { key: 'yaya', name: 'é¸­é¸­èµ„æº', icon: 'fa-solid fa-kiwi-bird' },
                { key: 'ckzy', name: 'CKèµ„æº', icon: 'fa-solid fa-cube' }
            ]);

            // èµ„æºåˆ—è¡¨ (ç‰¹æ®Š)
            const specialSources = ref([
                { key: '91madou', name: '91éº»è±†', icon: 'fa-solid fa-fire' },
                { key: 'jkun', name: 'JKUNèµ„æº', icon: 'fa-solid fa-music' },
                { key: 'siwa', name: 'ä¸è¢œèµ„æº', icon: 'fa-solid fa-socks' },
                { key: 'cl', name: 'ç™¾ä¸‡èµ„æº', icon: 'fa-solid fa-leaf' },
                { key: '155zy', name: '155èµ„æº', icon: 'fa-solid fa-1' },
                { key: 'souav', name: 'SouAV', icon: 'fa-solid fa-video' },
                { key: 'youyou', name: 'ä¼˜ä¼˜èµ„æº', icon: 'fa-solid fa-y' },
                { key: 'zuise', name: 'æœ€è‰²èµ„æº', icon: 'fa-solid fa-heart' },
                { key: 'aosika', name: 'å¥¥æ–¯å¡', icon: 'fa-solid fa-trophy' },
                { key: 'xiaoji', name: 'å°é¸¡èµ„æº', icon: 'fa-solid fa-egg' },
                { key: 'xing', name: 'å¹¸èµ„æº', icon: 'fa-solid fa-star' },
                { key: 'xingba', name: 'æå§èµ„æº', icon: 'fa-solid fa-lemon' },
                { key: 'didi', name: 'æ»´æ»´èµ„æº', icon: 'fa-solid fa-car' },
                { key: 'yutu', name: 'ç‰å…”èµ„æº', icon: 'fa-solid fa-rabbit' },
                { key: 'baipiao', name: 'ç™½å«–èµ„æº', icon: 'fa-solid fa-gift' },
                { key: 'meishaonv', name: 'ç¾å°‘å¥³', icon: 'fa-solid fa-person-dress' },
                { key: 'lebo', name: 'ä¹æ’­èµ„æº', icon: 'fa-solid fa-play' },
                { key: 'taohua', name: 'æ¡ƒèŠ±èµ„æº', icon: 'fa-solid fa-spa' }
            ]);

            const currentSourceKey = ref('guangsu');
            const currentSourceName = ref('å…‰é€Ÿèµ„æº');

            // æ’­æ”¾å™¨çŠ¶æ€
            const currentVod = ref(null);
            const episodes = ref({});
            const currentPlayUrl = ref('');
            const currentEpName = ref('');
            let hls = null;

            // æ ¸å¿ƒåŠŸèƒ½ï¼šæ¢è‚¤ (ä¿®å¤ç‰ˆ)
            // ç›´æ¥æ“ä½œ document.bodyï¼Œç¡®ä¿ 100% ç”Ÿæ•ˆ
            const switchTheme = () => {
                let index = themeList.indexOf(currentTheme.value);
                index = (index + 1) % themeList.length;
                currentTheme.value = themeList[index];
                
                // å¼ºåˆ¶åº”ç”¨åˆ° body
                document.body.className = currentTheme.value;
                localStorage.setItem('cloudtv_theme_v3', currentTheme.value);
            };

            const toggleSidebar = () => isSidebarOpen.value = !isSidebarOpen.value;

            // è·å–æ•°æ®
            const fetchData = async () => {
                if(loading.value) return;
                loading.value = true;
                list.value = [];
                
                try {
                    const target = currentSourceKey.value;
                    let url = `${API_PROXY}?from=${target}&ac=detail`;
                    
                    if(keyword.value) {
                        url += `&wd=${encodeURIComponent(keyword.value)}`;
                    } else if (currentCat.value !== 'latest') {
                        const map = { movie:'ç”µå½±', tv:'ç”µè§†å‰§', anime:'åŠ¨æ¼«', variety:'ç»¼è‰º' };
                        url += `&wd=${encodeURIComponent(map[currentCat.value])}`;
                    }

                    const res = await fetch(url);
                    const data = await res.json();
                    if(data.list) list.value = data.list;
                } catch(e) { console.error(e); }
                loading.value = false;
            };

            const changeSource = (s) => {
                currentSourceKey.value = s.key;
                currentSourceName.value = s.name;
                keyword.value = '';
                playerMode.value = false;
                fetchData();
                if(window.innerWidth < 768) isSidebarOpen.value = false;
            };

            const changeCat = (cat) => {
                currentCat.value = cat;
                keyword.value = '';
                fetchData();
            };

            const doSearch = () => {
                if(!keyword.value) return;
                currentCat.value = 'search';
                fetchData();
            };

            // æ’­æ”¾
            const openPlayer = (item) => {
                currentVod.value = item;
                const urlStr = item.vod_play_url;
                const eps = {};
                const splitChar = urlStr.includes('$$$') ? '$$$' : '#';
                const arr = urlStr.split(splitChar);
                let first = null;

                arr.forEach(seg => {
                    const p = seg.split('$');
                    if(p.length >= 2) {
                        const name = p[0];
                        const url = p[p.length-1];
                        if(url.includes('.m3u8') || url.includes('.mp4')) {
                            eps[name] = url;
                            if(!first) first = {name, url};
                        }
                    }
                });

                if(!first && arr.length > 0) {
                     const p = arr[0].split('$');
                     first = { name:'åœ¨çº¿æ’­æ”¾', url: p[p.length-1] };
                     eps['åœ¨çº¿æ’­æ”¾'] = first.url;
                }

                episodes.value = eps;
                if(first) switchEp(first.name, first.url);

                recommendList.value = list.value.filter(v => v.vod_id !== item.vod_id).slice(0, 12);
                playerMode.value = true;
                window.scrollTo(0,0);
            };

            const switchEp = (name, url) => {
                currentEpName.value = name;
                currentPlayUrl.value = url;
                setTimeout(() => {
                    const video = document.getElementById('player');
                    if(!video) return;
                    if (Hls.isSupported()) {
                        if(hls) hls.destroy();
                        hls = new Hls();
                        hls.loadSource(url);
                        hls.attachMedia(video);
                        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
                    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                        video.src = url;
                        video.play();
                    }
                }, 100);
            };

            const closePlayer = () => {
                playerMode.value = false;
                if(hls) hls.destroy();
            };

            const goHome = () => {
                keyword.value = '';
                playerMode.value = false;
                currentCat.value = 'latest';
                fetchData();
            };

            const imgError = (e) => {
                e.target.src = 'https://via.placeholder.com/300x450?text=No+Cover';
            };

            onMounted(() => {
                // åˆå§‹åŒ–ä¸»é¢˜
                const saved = localStorage.getItem('cloudtv_theme_v3');
                if(saved && themeList.includes(saved)) {
                    currentTheme.value = saved;
                }
                document.body.className = currentTheme.value; // ç¡®ä¿åˆå§‹åŒ–æ—¶Bodyæ ·å¼æ­£ç¡®
                
                fetchData();
            });

            return {
                showSpecial, // å¯¼å‡ºå¼€å…³å˜é‡
                API_PROXY,
                isSidebarOpen, toggleSidebar,
                currentTheme, switchTheme,
                generalSources, specialSources, currentSourceKey, currentSourceName, changeSource,
                currentCat, changeCat, keyword, doSearch,
                list, loading, playerMode,
                openPlayer, closePlayer, goHome,
                currentVod, episodes, currentPlayUrl, currentEpName, switchEp,
                recommendList, imgError
            };
        }
    }).mount('#app');
</script>
</body>
</html>