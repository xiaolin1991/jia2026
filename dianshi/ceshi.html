<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="referrer" content="no-referrer">
    <title>æ™“æ—å½±è§†åŸ</title>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        /* ========== å…³é”®ä¿®å¤ï¼šé»˜è®¤ CSS å˜é‡ ========== */
        :root {
            --sidebar-width: 240px;
            --header-height: 64px;
            --bg-body: #121212;
            --bg-sidebar: #1e1e1e;
            --bg-card: #2c2c2c;
            --text-main: #ffffff;
            --text-sub: #aaaaaa;
            --accent: #3ea6ff;
            --border: rgba(255,255,255,0.1);
            --hover: #333333;
            --pwa-bg: rgba(30,30,30,0.9);
            --live-bg: linear-gradient(135deg, rgba(62,166,255,0.9), rgba(8,132,227,0.85));
        }

        body.theme-dark { --bg-body: #121212; --bg-sidebar: #1e1e1e; --bg-card: #2c2c2c; --text-main: #fff; --text-sub: #aaa; --accent: #3ea6ff; --border: rgba(255,255,255,0.1); --hover: #333; --pwa-bg: rgba(30,30,30,0.9); --live-bg: linear-gradient(135deg, rgba(62,166,255,0.9), rgba(8,132,227,0.85)); }
        body.theme-light { --bg-body: #f5f7fa; --bg-sidebar: #fff; --bg-card: #fff; --text-main: #333; --text-sub: #666; --accent: #0984e3; --border: #e0e0e0; --hover: #f0f0f0; --pwa-bg: rgba(255,255,255,0.95); --live-bg: linear-gradient(135deg, rgba(56,189,248,0.9), rgba(3,105,161,0.85)); }
        body.theme-red { --bg-body: #000; --bg-sidebar: #141414; --bg-card: #1f1f1f; --text-main: #e5e5e5; --text-sub: #999; --accent: #e50914; --border: #333; --hover: #333; --pwa-bg: rgba(20,20,20,0.9); --live-bg: linear-gradient(135deg,#e50914,#c0392b); }
        body.theme-blue { --bg-body: #0f172a; --bg-sidebar: #1e293b; --bg-card: #334155; --text-main: #e2e8f0; --text-sub: #94a3b8; --accent: #38bdf8; --border: #475569; --hover: #475569; --pwa-bg: rgba(20,20,30,0.9); --live-bg: linear-gradient(135deg,#38bdf8,#1e3a8a); }
        body.theme-green { --bg-body: #f0fdf4; --bg-sidebar: #ffffff; --bg-card: #ffffff; --text-main: #14532d; --text-sub: #4ade80; --accent: #16a34a; --border: #bbf7d0; --hover: #dcfce7; --pwa-bg: rgba(255,255,255,0.95); --live-bg: linear-gradient(135deg,#34d399,#059669); }
        body.theme-purple { --bg-body: #2e1065; --bg-sidebar: #4c1d95; --bg-card: #5b21b6; --text-main: #ddd6fe; --text-sub: #a78bfa; --accent: #c084fc; --border: #6d28d9; --hover: #7c3aed; --pwa-bg: rgba(40,20,80,0.9); --live-bg: linear-gradient(135deg,#c084fc,#7c3aed); }
        body.theme-gold { --bg-body: #1c1c1c; --bg-sidebar: #2b2b2b; --bg-card: #383838; --text-main: #f1c40f; --text-sub: #bf953f; --accent: #f39c12; --border: #444; --hover: #4a4a4a; --pwa-bg: rgba(20,20,20,0.9); --live-bg: linear-gradient(135deg,#f39c12,#d4ac0d); }

        /* åŸºç¡€æ ·å¼ */
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: var(--bg-body); color: var(--text-main); transition: background 0.3s; }
        .app-layout { display: flex; flex-direction: column; height: 100%; width: 100%; overflow: hidden; }
        .main-container { display: flex; flex: 1; overflow: hidden; position: relative; width: 100%; }

        /* Header */
        .header { height: var(--header-height); background: var(--bg-sidebar); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 20px; position: relative; z-index: 5000; }
        .left-area { display: flex; align-items: center; gap: 15px; z-index: 5001; }
        .menu-toggle { font-size: 20px; cursor: pointer; padding: 5px; }
        .logo { font-size: 20px; font-weight: bold; display: flex; align-items: center; gap: 8px; cursor: pointer; white-space: nowrap; }
        .logo i { color: var(--accent); }
        .search-box { position: absolute; left: 50%; transform: translateX(-50%); width: 40%; max-width: 500px; display: flex; z-index: 5001; }
        .search-box input { width: 100%; background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main); padding: 10px 40px 10px 20px; border-radius: 50px; outline: none; }
        .search-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: var(--text-sub); }
        .header-right { position: absolute; right: 20px; top: 0; bottom: 0; display: flex; gap: 12px; align-items: center; z-index: 9999; }
        .btn-icon { width: 38px; height: 38px; border-radius: 50%; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; background: var(--bg-card); color: var(--text-main); }
        .btn-icon:hover { border-color: var(--accent); color: var(--accent); transform: scale(1.1); }

        /* Sidebar */
        .sidebar { width: var(--sidebar-width); background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; transition: transform 0.3s ease; }
        .sidebar-scroll { flex: 1; overflow-y: auto; padding: 10px 0; }
        .group-name { font-size: 12px; color: var(--text-sub); padding: 15px 15px 5px; font-weight: bold; }
        .nav-item { padding: 12px 15px; margin: 2px 10px; border-radius: 6px; cursor: pointer; color: var(--text-sub); display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .nav-item:hover { background: var(--hover); color: var(--text-main); }
        .nav-item.active { background: var(--accent); color: white; }
        .nav-item i { width: 18px; text-align: center; }
        .sidebar-footer { padding: 15px; border-top: 1px solid var(--border); background: var(--bg-sidebar); display: flex; flex-direction: column; gap: 10px; }
        .contact-title { font-size: 12px; color: var(--text-sub); font-weight: bold; margin-bottom: 5px; }
        .contact-link { display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: var(--bg-card); border-radius: 8px; color: var(--text-main); text-decoration: none; font-size: 14px; }
        .wechat-box { background: #fff; padding: 5px; border-radius: 8px; margin-top: 5px; }
        .wechat-box img { width: 100%; display: block; border-radius: 4px; }

        /* Content */
        .content { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 20px; position: relative; scroll-behavior: auto; width: 100%; box-sizing: border-box; }
        .cats { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .cat-btn { padding: 6px 18px; border-radius: 20px; border: 1px solid var(--border); background: var(--bg-card); font-size: 13px; cursor: pointer; color: var(--text-main); transition: 0.2s; }
        .cat-btn.active { background: var(--text-main); color: var(--bg-body); border-color: var(--text-main); font-weight: bold; }

        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .card { cursor: pointer; position: relative; width: 100%; overflow: hidden; }
        .poster-wrap { width: 100%; aspect-ratio: 2/3; border-radius: 8px; overflow: hidden; background: #000; position: relative; margin-bottom: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .poster { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
        .card:hover .poster { transform: scale(1.05); }
        .badge { position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.8); color: #fbbf24; font-size: 10px; padding: 2px 5px; border-radius: 4px; }
        .title { font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500; }

        /* Live Grid (ç¾åŒ–) */
        .live-panel { margin-bottom: 10px; display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
        .live-header { display:flex; align-items:center; gap:12px; }
        .live-title { font-size:18px; font-weight:700; color:var(--accent); display:flex; align-items:center; gap:8px; }
        .live-sub { font-size:13px; color:var(--text-sub); }
        .live-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; margin-top:10px; }
        .live-card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.05)); border: 1px solid var(--border); border-radius: 12px; cursor: pointer; overflow: hidden; transition: 0.2s; text-align: center; padding-bottom:8px; }
        .live-card:hover { transform: translateY(-6px); box-shadow: 0 8px 24px rgba(0,0,0,0.35); border-color: var(--accent); }
        .live-cover { height: 110px; width: 100%; display:flex; align-items:center; justify-content:center; color:#fff; font-size:18px; font-weight:700; position:relative; background: var(--live-bg); }
        .live-cover .play-icon { position:absolute; left:10px; top:10px; font-size:14px; opacity:0.9; }
        .live-name { padding: 12px 10px; font-size: 14px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .live-meta { font-size:12px; color:var(--text-sub); margin-top:4px; }

        .load-status { text-align: center; padding: 30px; color: var(--text-sub); font-size: 13px; width: 100%; clear: both; }

        /* Player */
        .player-page { max-width: 1000px; margin: 0 auto; animation: fade 0.3s; padding-bottom: 50px; width: 100%; box-sizing: border-box; }
        @keyframes fade { from { opacity: 0; } to { opacity: 1; } }
        .video-box { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 10px; overflow: hidden; margin-top: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        video { width: 100%; height: 100%; background: #000; }
        .controls { padding: 20px 0; }
        .back-btn { display: inline-flex; align-items: center; gap: 5px; padding: 8px 16px; background: var(--bg-card); border-radius: 6px; cursor: pointer; font-size: 14px; margin-bottom: 15px; }

        /* Mobile adjustments */
        @media (max-width: 768px) {
            .grid { grid-template-columns: repeat(3, 1fr); gap: 8px; }
            .live-grid { grid-template-columns: repeat(3, 1fr); gap: 8px; }
            .live-cover { height: 70px; font-size: 14px; }
            .video-box { border-radius: 0; margin: 0 -10px; width: calc(100% + 20px); }
        }
    </style>
</head>
<body>

<div id="app" class="app-layout">
    
    <header class="header">
        <div class="left-area">
            <i class="fa-solid fa-bars menu-toggle" @click="toggleSidebar"></i>
            <div class="logo" @click="goHome">
                <i class="fa-solid fa-cloud"></i> æ™“æ—å½±è§†åŸ
            </div>
        </div>

        <div class="search-box">
            <input v-model="keyword" @keyup.enter="doSearch" placeholder="æœç´¢å…¨ç½‘èµ„æº...">
            <i class="fa-solid fa-magnifying-glass search-icon" @click="doSearch"></i>
        </div>

        <div class="header-right">
            <div class="btn-icon mobile-search-trigger" @click="toggleMobileSearch">
                <i class="fa-solid fa-magnifying-glass"></i>
            </div>
            <div class="btn-icon" @click="openAppModal" title="APPä¸‹è½½">
                <i class="fa-solid fa-download"></i>
            </div>
            <div class="btn-icon" @click.stop="switchTheme" title="åˆ‡æ¢é¢œè‰²">
                <i class="fa-solid fa-palette"></i>
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar" :class="{ open: isSidebarOpen }">
            <div class="sidebar-scroll">
                
                <div class="group-name">åŠŸèƒ½æ¨¡å¼</div>
                <div class="nav-item" :class="{active: currentSourceKey !== 'live' && currentSourceKey !== 'history'}" @click="changeSource(generalSources[0])">
                    <i class="fa-solid fa-film"></i> é¦–é¡µ
                </div>
                <div class="nav-item" :class="{active: currentSourceKey === 'live'}" @click="enterLiveMode">
                    <i class="fa-solid fa-tv"></i> ç›´æ’­ç”µè§†
                </div>
                <div class="nav-item" :class="{active: currentSourceKey === 'history'}" @click="enterHistoryMode">
                    <i class="fa-solid fa-clock-rotate-left"></i> æ’­æ”¾è®°å½•
                </div>

                <div v-if="currentSourceKey !== 'live' && currentSourceKey !== 'history'">
                    <div class="group-name">å½“å‰çº¿è·¯</div>
                    <div class="nav-item active">
                        <i class="fa-solid fa-tower-broadcast"></i> {{ currentSourceName }}
                    </div>

                    <div class="group-name">ç»¼åˆèµ„æº</div>
                    <div v-for="s in generalSources" :key="s.key" 
                         class="nav-item" :class="{active: currentSourceKey === s.key}"
                         @click="changeSource(s)">
                        <i :class="s.icon"></i> {{ s.name }}
                    </div>

                    <div v-if="showSpecialSection">
                        <div class="group-name" style="color:#e74c3c; margin-top:20px;">ç‰¹æ®Š / ç¦åˆ©</div>
                        <div v-for="s in specialSources" :key="s.key" 
                             class="nav-item" :class="{active: currentSourceKey === s.key}"
                             @click="changeSource(s)">
                            <i :class="s.icon"></i> {{ s.name }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar-footer">
                <div class="contact-title">æœ‰é—®é¢˜æ‰¾åˆ°æˆ‘</div>
                <a href="https://github.com/xiaolin1991" target="_blank" class="contact-link">
                    <i class="fa-brands fa-github"></i> GitHub
                </a>
                <div class="contact-link" @click="toggleWechat">
                    <i class="fa-brands fa-weixin"></i> å¾®ä¿¡å’¨è¯¢
                </div>
                <div v-if="showWechat" class="wechat-box">
                    <img src="./wechat.png" alt="è¯·ä¸Šä¼  wechat.png">
                </div>
            </div>
        </aside>

        <div v-if="isSidebarOpen" @click="toggleSidebar" 
             style="position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:5500;"></div>

        <main class="content" ref="contentRef" @scroll="handleScroll">
            
            <div v-if="!isPlayerMode && currentSourceKey !== 'live'">
                <div class="cats" v-if="currentSourceKey !== 'history'">
                    <div class="cat-btn" :class="{active: currentCat==='latest'}" @click="changeCat('latest')">æœ€æ–°</div>
                    <div class="cat-btn" :class="{active: currentCat==='movie'}" @click="changeCat('movie')">ç”µå½±</div>
                    <div class="cat-btn" :class="{active: currentCat==='tv'}" @click="changeCat('tv')">å‰§é›†</div>
                    <div class="cat-btn" :class="{active: currentCat==='anime'}" @click="changeCat('anime')">åŠ¨æ¼«</div>
                    <div class="cat-btn" :class="{active: currentCat==='variety'}" @click="changeCat('variety')">ç»¼è‰º</div>
                </div>

                <div v-if="currentSourceKey === 'history'" style="margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-weight:bold;">æˆ‘çš„è§‚çœ‹å†å²</div>
                    <button class="pwa-btn" style="width:auto; padding:5px 15px; font-size:12px; background:#e74c3c;" @click="clearHistory">
                        <i class="fa-solid fa-trash"></i> æ¸…ç©ºè®°å½•
                    </button>
                </div>

                <div class="grid">
                    <div class="card" v-for="item in list" :key="item.vod_id" @click="openPlayer(item)">
                        <div class="poster-wrap">
                            <img :src="item.vod_pic" class="poster" @error="imgError" loading="lazy">
                            <div class="badge">{{ item.vod_remarks || item.vod_year }}</div>
                        </div>
                        <div class="title">{{ item.vod_name }}</div>
                        <div v-if="currentSourceKey === 'history' && item.lastEpName" 
                             style="font-size:11px; color:var(--text-sub); margin-top:2px;">
                             çœ‹åˆ°: {{ item.lastEpName }}
                        </div>
                    </div>
                </div>

                <div class="load-status">
                    <span v-if="loading && page===1">åˆå§‹åŒ–ä¸­...</span>
                    <span v-else-if="loading"><i class="fa-solid fa-spinner fa-spin"></i> åŠ è½½ä¸­...</span>
                    <span v-else-if="currentSourceKey === 'history' && list.length===0">æš‚æ— è§‚çœ‹è®°å½•</span>
                    <span v-else-if="!hasMore && list.length>0">ğŸ‰ å·²åŠ è½½å…¨éƒ¨</span>
                    <span v-else-if="list.length===0 && !loading" style="display:flex; flex-direction:column; align-items:center; gap:10px;">
                        <div>æš‚æ— æ•°æ®æˆ–åŠ è½½å¤±è´¥</div>
                        <button class="pwa-btn" style="width:auto; padding:8px 20px;" @click="fetchData(false)">é‡è¯•è¿æ¥</button>
                    </span>
                    <span v-else-if="currentSourceKey !== 'history'">å‘ä¸Šæ»‘åŠ¨åŠ è½½æ›´å¤š</span>
                </div>
            </div>

            <!-- ç¾åŒ–åçš„ç›´æ’­é¡µé¢ -->
            <div v-if="!isPlayerMode && currentSourceKey === 'live'">
                <div v-if="loading" style="text-align:center; padding:40px; color:var(--accent);">
                    <i class="fa-solid fa-satellite-dish fa-spin fa-2x"></i>
                    <p>æ­£åœ¨è·å–ç›´æ’­ä¿¡å·...</p>
                </div>
                
                <div v-else-if="Object.keys(liveGroups).length > 0">
                    <div class="live-panel">
                        <div class="live-header">
                            <div class="live-title"><i class="fa-solid fa-broadcast-tower"></i> ç›´æ’­ç”µè§†</div>
                            <div class="live-sub">ä¸ºæ‚¨èšåˆå¤šçº¿è·¯ç›´æ’­æºï¼Œè‹¥æœ‰æ’­æ”¾å¼‚å¸¸è¯·å°è¯•å…¶å®ƒé¢‘é“æˆ–ä½¿ç”¨ APP</div>
                        </div>
                        <div style="display:flex; gap:8px; flex-wrap:wrap;">
                            <div v-for="group in Object.keys(liveGroups)" :key="group" 
                                 class="cat-btn" :class="{active: currentLiveGroup === group}"
                                 @click="currentLiveGroup = group">
                                {{ group }} ({{ liveGroups[group].length }})
                            </div>
                        </div>
                    </div>

                    <div class="live-grid">
                        <div v-for="channel in liveGroups[currentLiveGroup]" :key="channel.vod_name" 
                             class="live-card" @click="playLive(channel)">
                            <div class="live-cover">
                                <i class="play-icon fa-solid fa-circle-play"></i>
                                {{ channel.vod_name.substring(0,10) }}
                            </div>
                            <div class="live-name">{{ channel.vod_name }}</div>
                            <div class="live-meta">{{ channel.vod_remarks || channel.type_name }}</div>
                        </div>
                    </div>
                </div>
                <div v-else style="text-align:center; margin-top:50px;">
                    <i class="fa-solid fa-triangle-exclamation fa-3x" style="color:var(--text-sub); margin-bottom:20px;"></i>
                    <p style="color:var(--text-sub)">æš‚æœªè·å–åˆ°æ•°æ®</p>
                    <button class="pwa-btn" style="width:auto; padding:10px 30px;" @click="enterLiveMode">å¼ºåˆ¶åˆ·æ–°é‡è¯•</button>
                </div>
            </div>

            <div v-else-if="isPlayerMode" class="player-page">
                <div class="back-btn" @click="closePlayer">
                    <i class="fa-solid fa-arrow-left"></i> è¿”å›åˆ—è¡¨
                </div>

                <div class="video-box">
                    <video id="player" controls autoplay playsinline></video>
                </div>

                <div class="controls">
                    <h2 style="margin:0;">{{ currentVod.vod_name }}</h2>
                    <div style="font-size:13px; color:var(--text-sub); margin-top:5px;">
                        æ­£åœ¨æ’­æ”¾: {{ currentEpName }} <span style="margin-left:10px; color:var(--accent)">({{ currentSourceName }})</span>
                    </div>

                    <div v-if="currentSourceKey !== 'live'" class="ep-list">
                        <div v-for="(url, name) in episodes" :key="name" 
                             class="ep-item" :class="{active: currentPlayUrl === url}"
                             @click="switchEp(name, url)">
                            {{ name }}
                        </div>
                    </div>
                </div>

                <h3 style="margin-top:30px;">çŒœä½ å–œæ¬¢</h3>
                <div class="grid">
                    <div class="card" v-for="item in recommendList" :key="item.vod_id" @click="openPlayer(item)">
                        <div class="poster-wrap">
                            <img :src="item.vod_pic" class="poster" @error="imgError">
                            <div class="badge">{{ item.vod_remarks }}</div>
                        </div>
                        <div class="title">{{ item.vod_name }}</div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <div v-if="showPwaModal" class="pwa-toast" :class="{ 'show-arrow': isIOS }">
        <div class="pwa-header">
            <div class="pwa-title"><i class="fa-solid fa-download"></i> å®‰è£…åº”ç”¨åˆ°æ¡Œé¢</div>
            <div class="pwa-close" @click="closePwaModal"><i class="fa-solid fa-xmark"></i></div>
        </div>
        <div class="pwa-desc">
            <div v-if="isIOS">ç‚¹å‡»ä¸‹æ–¹å·¥å…·æ  <i class="fa-solid fa-arrow-up-from-bracket"></i> åˆ†äº«æŒ‰é’®ï¼Œ<br>é€‰æ‹© <strong>â€œæ·»åŠ åˆ°ä¸»å±å¹•â€</strong>ã€‚</div>
            <div v-else>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å³å¯å®‰è£…åˆ°æ¡Œé¢ï¼Œä½“éªŒæ›´ä½³ã€‚</div>
        </div>
        <button v-if="!isIOS && installPrompt" class="pwa-btn" @click="installPwa">ç«‹å³å®‰è£…</button>
        <button v-else class="pwa-btn" @click="closePwaModal">çŸ¥é“äº†</button>
        <div v-if="isIOS" class="pwa-arrow"><i class="fa-solid fa-arrow-down fa-2x"></i></div>
    </div>

    <div v-if="showAppModal && enableAppModal" class="app-modal-overlay">
        <div class="app-modal-box">
            <div class="app-close" @click="closeAppModal"><i class="fa-solid fa-xmark"></i></div>
            <div class="app-modal-title">ä¸‹è½½å®¢æˆ·ç«¯ï¼Œä½“éªŒæ›´æµç•…</div>
            <div class="app-grid">
                <a href="#" class="app-item">
                    <i class="fa-brands fa-windows"></i>
                    <div>ç­‰å¾…ç”µè„‘ç‰ˆ</div>
                </a>
                <a href="https://git.hanglinkj.com/APP/%E6%99%93%E6%9E%97%E7%94%B5%E8%A7%86.apk" class="app-item">
                    <i class="fa-brands fa-android"></i>
                    <div>å®‰å“ç«¯ä¸‹è½½</div>
                </a>
                <a href="#" class="app-item">
                    <i class="fa-brands fa-apple"></i>
                    <div>ç­‰å¾…è‹¹æœç‰ˆ</div>
                </a>
                <a href="#" class="app-item">
                    <i class="fa-solid fa-tv"></i>
                    <div>ç­‰å¾…TVç‰ˆ</div>
                </a>
            </div>
            <div style="text-align:center; margin-top:20px; font-size:12px; color:var(--text-sub);">
                æ¨èä½¿ç”¨ APP è§‚çœ‹ï¼Œæ— å¹¿å‘Šã€æ›´ç¨³å®š
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, nextTick, onMounted } = Vue;

    createApp({
        setup() {
            // ===============================================
            // â­â­â­ ã€ç”¨æˆ·é…ç½®åŒºã€‘ â­â­â­
            // ===============================================
            
            // 1. ä½ çš„ API è½¬å‘åœ°å€ï¼ˆè¯·æ›¿æ¢ä¸ºä½ éƒ¨ç½²åˆ° Cloudflare Worker çš„ URLï¼‰
            // ç¤ºä¾‹: const API_PROXY = 'https://your-worker.example.workers.dev/';
            // æŠŠä¸‹é¢çš„å€¼æ›¿æ¢æˆä½ éƒ¨ç½²çš„ Worker URLï¼ˆåŠ¡å¿…æ˜¯ HTTPSï¼Œæœ«å°¾å¸¦æ–œæ ï¼‰
            const API_PROXY = 'https://api.hanglinkj.com/'; 

            // 2. ç‰¹æ®Š/ç¦åˆ©åŒºå¼€å…³
            const showSpecialSection = ref(false); 

            // 3. å¾®ä¿¡å›¾ç‰‡å¼€å…³
            const showWechat = ref(false);

            // 4. APPä¸‹è½½å¼¹çª—å¼€å…³ (æ–°å¢åŠŸèƒ½)
            const enableAppModal = ref(true);
            
            // ===============================================
            // â­â­â­ ã€é…ç½®ç»“æŸã€‘ â­â­â­
            // ===============================================

            // PWA & APP Modal
            const showPwaModal = ref(false);
            const showAppModal = ref(false);
            const isIOS = ref(false);
            const installPrompt = ref(null);

            const isSidebarOpen = ref(false);
            const showMobileSearch = ref(false);
            const mobileInputRef = ref(null);

            const themes = ['theme-dark', 'theme-light', 'theme-red', 'theme-blue', 'theme-green', 'theme-purple', 'theme-gold'];
            const currentTheme = ref('theme-dark');
            const isPlayerMode = ref(false);
            const loading = ref(false);
            const contentRef = ref(null);

            const list = ref([]);
            const recommendList = ref([]);
            const keyword = ref('');
            const currentCat = ref('latest');
            const page = ref(1);
            const hasMore = ref(true);

            // ç›´æ’­æ•°æ®
            const liveGroups = ref({});
            const currentLiveGroup = ref('');

            // æºåˆ—è¡¨ï¼ˆå®Œæ•´ä¿ç•™ï¼‰
            const generalSources = [
                { key: 'guangsu', name: 'å…‰é€Ÿèµ„æº', icon: 'fa-solid fa-bolt' },
                { key: 'liangzi', name: 'é‡å­èµ„æº', icon: 'fa-solid fa-atom' },
                { key: 'hongniu', name: 'çº¢ç‰›èµ„æº', icon: 'fa-solid fa-bullhorn' },
                { key: 'ikun', name: 'iKunèµ„æº', icon: 'fa-solid fa-basketball' },
                { key: 'tianya', name: 'å¤©æ¶¯å½±è§†', icon: 'fa-solid fa-mountain-sun' },
                { key: 'kuaiche', name: 'å¿«è½¦èµ„æº', icon: 'fa-solid fa-truck-fast' },
                { key: 'wujin', name: 'æ— å°½èµ„æº', icon: 'fa-solid fa-infinity' },
                { key: 'zuidazy', name: 'æœ€å¤§èµ„æº', icon: 'fa-solid fa-maximize' },
                { key: 'yinghua', name: 'æ¨±èŠ±èµ„æº', icon: 'fa-solid fa-fan' },
                { key: 'douban', name: 'è±†ç“£èµ„æº', icon: 'fa-brands fa-douban' },
                { key: 'subo', name: 'é€Ÿæ’­èµ„æº', icon: 'fa-solid fa-forward' },
                { key: 'uku', name: 'Ué…·èµ„æº', icon: 'fa-solid fa-u' },
                { key: 'shanhai', name: 'å±±æµ·èµ„æº', icon: 'fa-solid fa-water' },
                { key: 'xinlang', name: 'æ–°æµªèµ„æº', icon: 'fa-brands fa-weibo' },
                { key: 'wangwang', name: 'æ—ºæ—ºèµ„æº', icon: 'fa-solid fa-dog' },
                { key: 'baofeng', name: 'æš´é£èµ„æº', icon: 'fa-solid fa-wind' },
                { key: 'jisu', name: 'æé€Ÿèµ„æº', icon: 'fa-solid fa-gauge-high' },
                { key: 'maoyan', name: 'çŒ«çœ¼èµ„æº', icon: 'fa-solid fa-cat' },
                { key: 'suoni', name: 'ç´¢å°¼èµ„æº', icon: 'fa-solid fa-gamepad' },
                { key: 'maotai', name: 'èŒ…å°èµ„æº', icon: 'fa-solid fa-wine-bottle' },
                { key: 'huya', name: 'è™ç‰™èµ„æº', icon: 'fa-solid fa-paw' },
                { key: 'jinying', name: 'é‡‘é¹°èµ„æº', icon: 'fa-solid fa-feather' },
                { key: 'shandian', name: 'é—ªç”µèµ„æº', icon: 'fa-solid fa-bolt-lightning' },
                { key: 'feifan', name: 'éå‡¡èµ„æº', icon: 'fa-solid fa-plane' },
                { key: 'piaoling', name: 'é£˜é›¶èµ„æº', icon: 'fa-solid fa-snowflake' },
                { key: 'modu', name: 'é­”éƒ½èµ„æº', icon: 'fa-solid fa-city' },
                { key: 'yaya', name: 'é¸­é¸­èµ„æº', icon: 'fa-solid fa-kiwi-bird' },
                { key: 'ckzy', name: 'CKèµ„æº', icon: 'fa-solid fa-cube' }
            ];

            const specialSources = [
                { key: '91madou', name: '91éº»è±†', icon: 'fa-solid fa-fire' },
                { key: 'jkun', name: 'JKUNèµ„æº', icon: 'fa-solid fa-music' },
                { key: 'siwa', name: 'ä¸è¢œèµ„æº', icon: 'fa-solid fa-socks' },
                { key: 'cl', name: 'ç™¾ä¸‡èµ„æº', icon: 'fa-solid fa-leaf' },
                { key: '155zy', name: '155èµ„æº', icon: 'fa-solid fa-1' },
                { key: 'souav', name: 'SouAV', icon: 'fa-solid fa-video' },
                { key: 'youyou', name: 'ä¼˜ä¼˜èµ„æº', icon: 'fa-solid fa-y' },
                { key: 'zuise', name: 'æœ€è‰²èµ„æº', icon: 'fa-solid fa-heart' },
                { key: 'aosika', name: 'å¥¥æ–¯å¡', icon: 'fa-solid fa-trophy' },
                { key: 'xiaoji', name: 'å°é¸¡èµ„æº', icon: 'fa-solid fa-egg' },
                { key: 'xing', name: 'å¹¸èµ„æº', icon: 'fa-solid fa-star' },
                { key: 'xingba', name: 'æå§èµ„æº', icon: 'fa-solid fa-lemon' },
                { key: 'didi', name: 'æ»´æ»´èµ„æº', icon: 'fa-solid fa-car' },
                { key: 'yutu', name: 'ç‰å…”èµ„æº', icon: 'fa-solid fa-rabbit' },
                { key: 'baipiao', name: 'ç™½å«–èµ„æº', icon: 'fa-solid fa-gift' },
                { key: 'meishaonv', name: 'ç¾å°‘å¥³', icon: 'fa-solid fa-person-dress' },
                { key: 'lebo', name: 'ä¹æ’­èµ„æº', icon: 'fa-solid fa-play' },
                { key: 'taohua', name: 'æ¡ƒèŠ±èµ„æº', icon: 'fa-solid fa-spa' }
            ];

            const currentSourceKey = ref('guangsu');
            const currentSourceName = ref('å…‰é€Ÿèµ„æº');
            const currentVod = ref(null);
            const episodes = ref({});
            const currentPlayUrl = ref('');
            const currentEpName = ref('');
            let hls = null;

            // --- æ–°å¢ï¼šAPPä¸‹è½½å¼¹çª—é€»è¾‘ ---
            const initAppModal = () => {
                if(!enableAppModal.value) return;
                const hasShown = sessionStorage.getItem('app_modal_shown_v1');
                if(!hasShown) {
                    setTimeout(() => { showAppModal.value = true; }, 800);
                }
            };
            const closeAppModal = () => {
                showAppModal.value = false;
                sessionStorage.setItem('app_modal_shown_v1', 'true');
            };
            const openAppModal = () => {
                showAppModal.value = true;
            };

            // --- æ–°å¢ï¼šå†å²è®°å½•é€»è¾‘ ---
            const saveHistory = (item, epName, playUrl) => {
                if(currentSourceKey.value === 'live') return; // ç›´æ’­ä¸è®°
                try {
                    let history = JSON.parse(localStorage.getItem('cloudtv_history_v1') || '[]');
                    history = history.filter(h => h.vod_id !== item.vod_id);
                    history.unshift({
                        ...item,
                        lastEpName: epName,
                        lastPlayUrl: playUrl,
                        lastSourceKey: currentSourceKey.value,
                        lastSourceName: currentSourceName.value,
                        timestamp: new Date().getTime()
                    });
                    if(history.length > 50) history.pop();
                    localStorage.setItem('cloudtv_history_v1', JSON.stringify(history));
                } catch(e) { console.error('Save history failed', e); }
            };

            const enterHistoryMode = () => {
                currentSourceKey.value = 'history';
                currentSourceName.value = 'æ’­æ”¾è®°å½•';
                keyword.value = '';
                isPlayerMode.value = false;
                if(window.innerWidth < 768) isSidebarOpen.value = false;
                fetchData(false);
            };

            const clearHistory = () => {
                if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è§‚çœ‹è®°å½•å—ï¼Ÿ')) {
                    localStorage.removeItem('cloudtv_history_v1');
                    list.value = [];
                }
            };

            // PWA
            const initPWA = () => { window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); installPrompt.value = e; checkShow(); }); checkShow(); };
            const checkShow = () => { if (localStorage.getItem('pwa_prompt_v13')) return; isIOS.value = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream; const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent); if(isMobile) showPwaModal.value = true; };
            const installPwa = () => { if (installPrompt.value) { installPrompt.value.prompt(); installPrompt.value.userChoice.then((choice) => { if (choice.outcome === 'accepted') closePwaModal(); }); } };
            const closePwaModal = () => { showPwaModal.value = false; localStorage.setItem('pwa_prompt_v13', 'true'); };

            const applyTheme = (theme) => { currentTheme.value = theme; document.body.className = theme; localStorage.setItem('cloudtv_theme_v10', theme); };
            const switchTheme = () => { let idx = themes.indexOf(currentTheme.value); if(idx === -1) idx = 0; idx = (idx + 1) % themes.length; applyTheme(themes[idx]); };
            const toggleSidebar = () => isSidebarOpen.value = !isSidebarOpen.value;
            const toggleWechat = () => showWechat.value = !showWechat.value;
            
            const toggleMobileSearch = () => {
                showMobileSearch.value = !showMobileSearch.value;
                if(showMobileSearch.value) {
                    nextTick(() => mobileInputRef.value && mobileInputRef.value.focus());
                }
            };

            // Utilities: åˆ¤æ–­æ˜¯å¦ä¸ºå¯ç›´æ¥æ’­æ”¾çš„ URL
            const isDirectPlayable = (u) => {
                if(!u) return false;
                const s = String(u).trim();
                if (s.startsWith('file://')) return false;
                if (!/^https?:\/\//i.test(s)) return false;
                return (s.includes('.m3u8') || s.includes('.mp4'));
            };

            // proxify helper: å°†åŸå§‹ URL è½¬ä¸ºä»£ç† URLï¼ˆAPI_PROXY å¿…é¡»é…ç½®ï¼‰
            const proxify = (orig) => {
                if(!API_PROXY) return orig;
                try {
                    return API_PROXY + 'proxy?url=' + encodeURIComponent(orig);
                } catch(e) {
                    return orig;
                }
            };

            const enterLiveMode = async () => {
                currentSourceKey.value = 'live';
                currentSourceName.value = 'ç”µè§†ç›´æ’­';
                isPlayerMode.value = false;
                if(window.innerWidth < 768) isSidebarOpen.value = false;
                
                loading.value = true;
                liveGroups.value = {}; 
                
                try {
                    const res = await fetch(`${API_PROXY}?from=live&t=${new Date().getTime()}`);
                    const data = await res.json();
                    
                    const groups = {};
                    if(data.list) {
                        data.list.forEach(item => {
                            const gName = item.type_name || 'å…¶ä»–';
                            if(!groups[gName]) groups[gName] = [];
                            groups[gName].push(item);
                        });
                    }
                    liveGroups.value = groups;
                    if(groups['ç²¾é€‰é«˜æ¸…']) currentLiveGroup.value = 'ç²¾é€‰é«˜æ¸…';
                    else currentLiveGroup.value = Object.keys(groups)[0] || '';
                } catch (e) { console.error('ç›´æ’­åŠ è½½å¤±è´¥', e); alert('ç›´æ’­æ•°æ®è·å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä½ çš„ Cloudflare Worker API æ˜¯å¦å·²éƒ¨ç½²å¹¶æ­£ç¡®å¡«å†™åˆ° API_PROXY'); }
                loading.value = false;
            };

            // æ›´ç¨³å¥çš„ playLiveï¼šè§£æå¤šç§æ ¼å¼å¹¶åšæ’­æ”¾å‰æ ¡éªŒ / å›é€€
            const playLive = (channel) => {
                currentVod.value = channel;
                currentEpName.value = 'ç›´æ’­ä¸­';
                currentSourceName.value = 'ç”µè§†ç›´æ’­';
                isPlayerMode.value = true;

                const urlStr = channel.vod_play_url || '';
                const split = urlStr.includes('$$$') ? '$$$' : (urlStr.includes('#') ? '#' : '$');
                const arr = urlStr.split(split);
                let candidate = '';
                for (const seg of arr) {
                    const p = seg.split('$');
                    const possible = (p[p.length - 1] || '').trim();
                    if (!possible) continue;
                    if (/^https?:\/\//i.test(possible) && (possible.includes('.m3u8') || possible.includes('.mp4'))) {
                        candidate = possible;
                        break;
                    }
                    if (!candidate) candidate = possible;
                }
                if (!candidate && urlStr) candidate = urlStr;

                // å¦‚æœæ˜¯ç›´æ¥å¯æ’­æ”¾çš„ HLS/MP4ï¼Œäº¤ç»™æ’­æ”¾å™¨
                if (isDirectPlayable(candidate)) {
                    // å¦‚æœæ˜¯ http åœ¨ https é¡µé¢ä¸‹ï¼Œä½¿ç”¨ proxy
                    if (/^http:\/\//i.test(candidate) && location.protocol === 'https:') {
                        if (API_PROXY) candidate = proxify(candidate);
                        else {
                            alert('è¯¥é¢‘é“ä¸º HTTP åœ°å€ï¼Œæµè§ˆå™¨ä¼šé˜»æ­¢æ··åˆå†…å®¹ã€‚è¯·éƒ¨ç½²ä»£ç†å¹¶é…ç½® API_PROXYã€‚å·²åœ¨æ–°æ ‡ç­¾æ‰“å¼€æºé¡µé¢ã€‚');
                            window.open(candidate, '_blank');
                            isPlayerMode.value = false;
                            return;
                        }
                    }
                    episodes.value = { 'ç›´æ’­': candidate };
                    switchEp('ç›´æ’­', candidate);
                    nextTick(() => { if (contentRef.value) contentRef.value.scrollTop = 0; });
                    return;
                }

                // å¦‚æœæ˜¯ http(s) ä½†ä¸æ˜¯ m3u8/mp4ï¼ˆä¾‹å¦‚ HTML é¡µé¢ï¼‰ï¼Œåœ¨æ–°æ ‡ç­¾æ‰“å¼€
                if (/^https?:\/\//i.test(candidate)) {
                    if (location.protocol === 'https:' && candidate.startsWith('http:')) {
                        alert('è¯¥é¢‘é“ä¸ºé HTTPS åœ°å€ï¼Œæµè§ˆå™¨å°†åœ¨ GitHub Pagesï¼ˆHTTPSï¼‰ä¸‹é˜»æ­¢æ··åˆå†…å®¹æ’­æ”¾ã€‚å»ºè®®ä½¿ç”¨ Cloudflare ä»£ç†å°†å…¶è½¬ä¸º HTTPS åæ’­æ”¾ã€‚å·²åœ¨æ–°æ ‡ç­¾ä¸­æ‰“å¼€æºé¡µé¢ã€‚');
                    } else {
                        alert('è¯¥é¢‘é“ä¸æ˜¯ç›´æ¥çš„åª’ä½“æµï¼Œä¼šåœ¨æ–°æ ‡ç­¾ä¸­æ‰“å¼€æºé¡µé¢ä»¥ä¾¿æ‰‹åŠ¨æ’­æ”¾æˆ–æŸ¥çœ‹ã€‚');
                    }
                    window.open(candidate, '_blank');
                    isPlayerMode.value = false;
                    return;
                }

                alert('æœªèƒ½è§£æåˆ°å¯æ’­æ”¾çš„ç›´æ’­æµï¼Œå¯èƒ½è¿”å›äº†ä¸å¯è¯†åˆ«çš„æ ¼å¼æˆ–æœ¬åœ°è·¯å¾„ã€‚');
                isPlayerMode.value = false;
            };

            const fetchData = async (isLoadMore = false) => {
                if(loading.value) return; 
                if(!hasMore.value && isLoadMore) return; 
                
                if(currentSourceKey.value === 'history') {
                    loading.value = true;
                    const history = JSON.parse(localStorage.getItem('cloudtv_history_v1') || '[]');
                    list.value = history;
                    hasMore.value = false; 
                    loading.value = false;
                    return;
                }

                loading.value = true;
                if (!isLoadMore) { page.value = 1; list.value = []; hasMore.value = true; if(contentRef.value) contentRef.value.scrollTop = 0; }
                try {
                    const target = currentSourceKey.value;
                    let url = `${API_PROXY}?from=${target}&ac=detail&pg=${page.value}`;
                    
                    if(keyword.value) url += `&wd=${encodeURIComponent(keyword.value)}`;
                    else if (currentCat.value !== 'latest') {
                        const map = { movie:'ç”µå½±', tv:'ç”µè§†å‰§', anime:'åŠ¨æ¼«', variety:'ç»¼è‰º' };
                        url += `&wd=${encodeURIComponent(map[currentCat.value])}`;
                    }
                    const res = await fetch(url);
                    const data = await res.json();
                    if(data.list && data.list.length > 0) {
                        if (isLoadMore) list.value = [...list.value, ...data.list];
                        else list.value = data.list;
                        page.value++;
                    } else hasMore.value = false;
                } catch(e) { hasMore.value = false; console.error('fetchData error', e); }
                loading.value = false;
            };

            const handleScroll = (e) => {
                if (currentSourceKey.value === 'live' || currentSourceKey.value === 'history') return;
                const { scrollTop, scrollHeight, clientHeight } = e.target;
                if (scrollTop + clientHeight >= scrollHeight - 100) {
                    if (!loading.value && hasMore.value) fetchData(true);
                }
            };

            const changeSource = (s) => {
                currentSourceKey.value = s.key;
                currentSourceName.value = s.name;
                keyword.value = '';
                isPlayerMode.value = false;
                fetchData(false);
                if(window.innerWidth < 768) isSidebarOpen.value = false;
            };

            const changeCat = (cat) => {
                currentCat.value = cat;
                keyword.value = '';
                fetchData(false);
            };

            const doSearch = () => {
                if(!keyword.value) return;
                showMobileSearch.value = false;
                if(currentSourceKey.value === 'live' || currentSourceKey.value === 'history') { 
                    currentSourceKey.value = 'guangsu'; 
                    currentSourceName.value = 'å…‰é€Ÿèµ„æº'; 
                }
                currentCat.value = 'search';
                fetchData(false);
            };

            const openPlayer = (item) => {
                currentVod.value = item;
                const urlStr = item.vod_play_url || '';
                const eps = {};
                const split = urlStr.includes('$$$') ? '$$$' : '#';
                const arr = urlStr.split(split);
                let first = null;
                arr.forEach(seg => {
                    const p = seg.split('$');
                    if(p.length >= 2) {
                        const n = p[0] || 'æ’­æ”¾';
                        const u = p[p.length-1] ? p[p.length-1].trim() : '';
                        if(u) {
                            // å¯¹ http åœ¨ https é¡µé¢åš proxify
                            let finalUrl = u;
                            if (/^http:\/\//i.test(u) && location.protocol === 'https:' && API_PROXY) finalUrl = proxify(u);
                            eps[n] = finalUrl;
                            if(!first && (finalUrl.includes('.m3u8') || finalUrl.includes('.mp4'))) first = {n, u: finalUrl};
                            else if(!first) first = {n, u: finalUrl};
                        }
                    }
                });
                if(!first && arr.length > 0) {
                    const p = arr[0].split('$');
                    const u = p[p.length-1] || arr[0];
                    let finalUrl = u;
                    if (/^http:\/\//i.test(u) && location.protocol === 'https:' && API_PROXY) finalUrl = proxify(u);
                    first = { n:'æ’­æ”¾', u: finalUrl };
                    eps['æ’­æ”¾'] = finalUrl;
                }
                episodes.value = eps;
                
                // ä¼˜å…ˆæ’­æ”¾å†å²è®°å½•çš„é›†æ•°
                if(currentSourceKey.value === 'history' && item.lastEpName && eps[item.lastEpName]) {
                    switchEp(item.lastEpName, eps[item.lastEpName]);
                } else if(first) {
                    switchEp(first.n, first.u);
                }
                
                recommendList.value = list.value.filter(v=>v.vod_id!==item.vod_id).slice(0, 12);
                isPlayerMode.value = true;
                nextTick(() => { if(contentRef.value) contentRef.value.scrollTop = 0; });
            };

            // switchEp å¢åŠ æ’­æ”¾å‰æ ¡éªŒï¼›å¯¹é HLS/MP4 åœ°å€å›é€€åˆ°æ–°æ ‡ç­¾æ‰“å¼€
            const switchEp = (name, url) => {
                currentEpName.value = name;
                currentPlayUrl.value = url;
                
                if(currentVod.value) {
                    saveHistory(currentVod.value, name, url);
                }

                if (!url) { alert('æ’­æ”¾åœ°å€ä¸ºç©º'); return; }
                if (!isDirectPlayable(url)) {
                    if (/^https?:\/\//i.test(url)) {
                        alert('åœ°å€ä¸æ˜¯ç›´æ¥çš„ HLS/MP4 æµï¼Œå·²åœ¨æ–°æ ‡ç­¾æ‰“å¼€ä»¥ä¾¿æŸ¥çœ‹æºé¡µé¢æˆ–å°è¯•æ’­æ”¾ã€‚');
                        window.open(url, '_blank');
                        return;
                    } else {
                        alert('æ— æ³•æ’­æ”¾æ­¤åœ°å€ï¼ˆå¯èƒ½ä¸ºæœ¬åœ°è·¯å¾„æˆ–ä¸å—æ”¯æŒçš„æ ¼å¼ï¼‰');
                        return;
                    }
                }

                setTimeout(() => {
                    const video = document.getElementById('player');
                    if(!video) return;
                    if (Hls.isSupported()) {
                        if(hls) hls.destroy();
                        hls = new Hls({ xhrSetup: function (xhr, url) { xhr.withCredentials = false; } });
                        hls.loadSource(url);
                        hls.attachMedia(video);
                        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
                    } else if (video.canPlayType('application/vnd.apple.mpegurl')) { video.src = url; video.play(); }
                }, 100);
            };

            const closePlayer = () => { isPlayerMode.value = false; if(hls) hls.destroy(); };
            const goHome = () => { 
                keyword.value = ''; 
                isPlayerMode.value = false; 
                currentCat.value = 'latest'; 
                if(currentSourceKey.value === 'live' || currentSourceKey.value === 'history') { 
                    currentSourceKey.value = 'guangsu'; 
                    currentSourceName.value = 'å…‰é€Ÿèµ„æº'; 
                } 
                fetchData(false); 
            };
            const imgError = (e) => e.target.src = 'https://via.placeholder.com/300x450?text=No+Cover';

            onMounted(() => {
                const saved = localStorage.getItem('cloudtv_theme_v10');
                if(saved && themes.includes(saved)) applyTheme(saved); else applyTheme('theme-dark');
                fetchData(false);
                initPWA();
                initAppModal(); // åˆå§‹åŒ– APP å¼¹çª—
            });

            return {
                contentRef, showSpecialSection, showWechat, enableAppModal,
                isSidebarOpen, toggleSidebar, toggleWechat,
                currentTheme, switchTheme,
                generalSources, specialSources, currentSourceKey, currentSourceName, changeSource,
                currentCat, changeCat, keyword, doSearch,
                list, loading, isPlayerMode,
                openPlayer, closePlayer, goHome,
                currentVod, episodes, currentPlayUrl, currentEpName, switchEp,
                recommendList, imgError,
                handleScroll, page, hasMore,
                showPwaModal, closePwaModal, isIOS, installPwa, installPrompt,
                enterLiveMode, liveGroups, currentLiveGroup, playLive, fetchData,
                showMobileSearch, toggleMobileSearch, mobileInputRef,
                // App Modal & History
                showAppModal, closeAppModal, openAppModal,
                enterHistoryMode, clearHistory
            };
        }
    }).mount('#app');
</script>
</body>
</html>